<!doctype html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport"
          content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Profile</title>
    <style>
        .profile{
            margin-left: 400px;
            margin-top: 174px;
        }
        .imageDiv{
            border: 2px solid black;
            width: 30%;
            height: 160px;
            float: left;
        }
        .details{
            margin-left: 40px;
            width: 40%;
            float: left;
        }
        .profile h2{
            margin-left: 280px;
            white-space: nowrap;
        }
        .details label{
            display: block;
            margin-top: 4px;
        }
        .profilePic{
            width: 100%;
            height: 100%;
        }

        .details input[type='text']{
            border-radius: 10px;
            margin-bottom: 3px;
            border-color: #307a35;
        }

        #submitBtn{
            margin-top: 10px;
            margin-left: 100px;
            border-radius: 10px;
            background-color: #30989c;
        }

        #ïmageChooser{
            border-radius: 10px;
            background-color: #30989c;
        }
    </style>
    <script>
        function updateUserInfo(){
            let response = confirm("Are you sure you want to make the changes?");
            if(response){
            let fName= $('#fName').val();
            let lName= $('#lName').val();
            if(fName=='' || lName==''){
                alert("Fields cannot be empty.")
                return;
            }
            let file = $('#imageChooser')[0].files[0]
            const formData = new FormData();
            formData.append('fName', fName);
            formData.append('lName', lName);
            if(file)
            formData.append('image', file);
            $.ajax({
                url:'/updateUser',
                method: 'POST',
                data: formData,
                processData: false,
                contentType: false,
                success:function(){
                    window.location.href='/profile';
                },
                error:function(){
                    alert('Something went wrong. Please try again later.');
                }
            })
            }
            
            
        }
    </script>
</head>
<body>
<div class="profile">
        <h2>Profile Details</span></h2>
        <form>
        <div class="imageDiv">
            <img class="profilePic" th:src="${data.get('displayPic')}"/>
        </div>
        <div class="details">
            <label for="userTxt">Username</label><input type="text" th:value="${data.get('lastName')}" id="userTxt" disabled/>
            <label for="fName">First Name</label><input type="text" id="fName" th:value="${data.get('firstName')}"/>
            <label for="lName">Last Name</label><input type="text" id="lName" th:value="${data.get('lastName')}"/>
            <label for="imageChooser">Choose Image</label>
            <input id="imageChooser" name="ïmageChooser" type="file" accept="image/*"/>
            <input type="button" value="Update" id="submitBtn" onclick="updateUserInfo()"/>
        </div>
        </form>
    </div>
</body>
</html>